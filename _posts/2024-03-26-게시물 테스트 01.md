---
title: 악성 코드 분석 기초
date: 2024-03-26 13:50:00 +09:00
categories: [
  Computer_Science,
  Information_Security,
  Malicious_Code,  
]
tags: [
  정보보안,
  악성 코드,
  멀웨어,
]
---

### 현재 내용 수정 중
[//]: # (### 테스트 진행 중)

[//]: # ()
[//]: # (#### 내용 작성 확인)

<blockquote class="custom-lightgreen">

</blockquote>

### 악성코드의 정의

#### 악성코드란??

<blockquote>
 악성코드(Malware) == 악성 소프트웨어(Malicious Software)의 줄인말로 악의적인 목적을 가진 코드(스크립트, 프로그램)를 총칭
</blockquote>

#### 사이버 킬 체인

- 사이버 공격을 공격자가 대상을 공격하는데 사용하는 일련의 단계를 구분하는 분석 모델

##### 정찰(Reconnaissance)

공격자는 정보를 수집하기 위해  이메일, 크롤링, SNS, 사회공학적 기법 등을 이용해 피해자의 정보 탐색 활동을 수행하는 단계.

##### 제작(Weaponization)

수집된 정보를 바탕으로 공격자는 공격 도구나 악성코드를 만들어 무기화합니다. 예를 들어 이메일 첨부파일에 악성코드를 삽입하는 등의 행위가 여기에 해당됨.

##### 전달(Delivery)

악성코드나 공격 도구가 피해자에게 전달되는 과정. 이메일(Phishing toolkits, 커스텀 스크립트, 공격자가 개발한 이메일 발송 툴을 이용한 URL, 악성코드가 포함된 첨부파일이 들어간 메일 전송), 웹 사이트, USB 드라이브, 터미널(SSH 터널링 도구, PuTTY) 등 다양한 수단이 사용됨.

##### 취약점 공격(Exploit)

전달된 악성 코드가 실행되어 피해자의 시스템 내에서 웹, OS, APP의 취약점을 찾아 공격하는 단계. 이 단계에서 실제로 시스템이 손상됨.

##### 설치(Installation)

악성코드가 시스템에 자리 잡고 지속적으로 악의적인 활동을 할 수 있도록 자신을 설치하는 단계.

##### 명령 및 제어(Command & Control)

공격자가 외부로부터 감염된 시스템을 제어할 수 있는 통신 채널을 확립하는 단계.

##### 행동(Actions on Objectives)

공격자가 시스템을 장악하고 최종 목적을 수행하는 단계. 데이터를 탈취하거나, 시스템을 조작하거나, 추가 공격을 준비함.


### 악성코드의 주요 유형

#### 악성코드의 행위에 의한 분류

##### 바이러스(Virus)

<blockquote class="custom-lightblue">

</blockquote>

실행 가능한 파일이나 문서와 같은 다른 프로그램에 부착하여 전파되는 악성코드
컴퓨터가 재부팅될 때 또는 특정 조건이 충족될 때 활성화되어 시스템에 피해를 줌

##### 트로이 목마(Trojan Horse):

<blockquote class="custom-lightblue">

</blockquote>

유용한 프로그램으로 위장하여 사용자가 시스템에 설치하도록 유도
설치된 후에 비밀리에 다른 악의적인 활동을 수행

##### 스파이웨어(Spyware)

<blockquote class="custom-lightblue">

</blockquote>

사용자의 개인 정보나 인터넷 사용 습관을 동의없이 추적, 수집하는 악성코드
키보드 입력, 인터넷 사용 기록, 신용카드 정보 등 다양하게 정보 수집
이메일, 메신저, SNS 등 다양한 경로를 통해 설치 유도
수집된 정보는 광고 목적으로 사용되거나 악의적인 행위자에게 판매


##### 웜(Worm):

스스로를 복제하여 컴퓨터 네트워크를 통해 다른 시스템으로 퍼지는 악성코드
특정 취약점을 이용해 자동으로 전파되며, 대량의 트래픽을 발생시켜 네트워크를 마비시킴킴

#### 악성코드의 목적에 의한 분류

##### 랜섬웨어(Ransomware)

시스템에 있는 파일을 암호화하고, 이를 복호화하는 키를 제공하는 대가로 금전을 요구
기기 취약점을 통해 침투하여 볼륨 쉐도우 카피 정보 손상을 발생

##### 애드웨어(Adware) 및 PUP(잠재적으로 원치 않는 프로그램)

광고를 강제로 보여주거나 브라우저의 홈페이지를 변경하는 등의 방법으로 사용자의 온라인 활동을 방해

##### 루트킷(Rootkit):=

운영체제의 핵심 부분에 숨어서 다른 악성 활동을 감추는 데 사용
감염된 시스템에서 악성 코드의 존재를 숨기고, 원격 제어를 위한 통로를 제공

##### 키로거(Keylogger)

키보드 입력을 몰래 기록하여 사용자의 개인정보나 로그인 정보를 탈취하는 데 사용

##### 다운로더(Downloader) 및 드로퍼(Dropper)

추가적인 악성 코드를 시스템에 다운로드하고 실행하는 데 사용
다운로더는 다른 악성 코드를 다운로드하기 위한 목적으로, 드로퍼는 시스템에 숨겨진 악성 코드를 배포하기 위해 사용

##### 백도어(Backdoor)

원격으로 시스템에 접근할 수 있는 숨겨진 통로를 제공
공격자가 시스템에 쉽게 재진입할 수 있도록 하며, 감염된 시스템을 제어하거나 추가적인 악성 행위를 수행하는 데 사용

#### 악성코드 일부 기법

#### 피싱(Phishing)

- 대규모로 이루어지는 사기 공격으로, 이메일, 웹사이트, 메시지 등을 통해 사용자를 속여 개인 정보, 금융 정보 등을 탈취
- 광범위한 수신자에게 발송되며, 특정 대상을 지정하지 않음
  
#### 스피어 피싱(Spear Phishing)

- 피싱의 한 형태로, 더 세분화되고 타깃이 명확한 공격
- 공격자는 특정 개인이나 조직을 대상으로 맞춤형 이메일이나 메시지를 보내 그들을 속여 정보를 탈취하거나 악성코드를 설치하여 후속 공격을 진행행


### 악성코드 피해 사례

#### 데이터 손실 및 훼손

- 바이러스나 일부 트로이 목마는 감염된 시스템 내 파일을 삭제하거나 손상시켜 중요한 데이터를 상실하게 만듦

##### 금융적 손실

- 랜섬웨어 공격은 피해자의 파일을 암호화하고 이를 풀기 위한 몸값을 요구합니다. 지불하지 않을 경우 데이터를 잃게 됨
- WannaCry 랜섬웨어 같이 전 세계적으로 큰 피해를 준 사례가 있으며, 여러 기업과 기관에서 경제적 손실을 입음

##### 개인정보 도용

- 스파이웨어나 키로거와 같은 악성 코드는 사용자의 개인정보를 무단으로 수집하여 범죄에 활용합니다.
- 개인 신용카드 정보나 로그인 자격 증명 정보가 탈취되어 금융 사기의 피해자 발생

##### 시스템 성능 저하

- 시스템 자원을 과도하게 소모하여 컴퓨터의 성능을 저하시킴
- 백그라운드에서 은밀히 활동하는 악성 코드가 많은 CPU와 메모리를 사용하여 개인 및 기업의 컴퓨터가 제 성능을 발휘하지 못하게 함

#### 서비스 중단

- 분산 서비스 거부(DDoS) 공격에 사용되는 웜과 같은 악성 코드는 웹사이트나 온라인 서비스를 중단시킬 수 있음
- Dyn DNS 공급업체에 대한 대규모 DDoS 공격이나 최근의 LCK에서 벌어지는 공격 같이 특정 서비스나 웹사이트에 수 시간 동안 접속 불능 상태로 만듦


#### 사이버 정보전:

- 정부나 기업을 대상으로 한 특정 국가가 지원하는 고급 지속 위협(APT) 공격은 정치적, 군사적, 경제적 목적으로 기밀 정보를 탈취할 수 있음
- Stuxnet 웜은 이란의 우라늄 농축 시설을 목표로 한 사이버 공격이나 현재 대한민국에 대한 북한의 사이버 공격 등이 있음


### 악성코드 분석 방법론

#### 패턴 분석 (Pattern Analysis)

- 파일 형태 분석: 파일의 구조 및 형식을 분석하여 악성코드인지를 판단
- API 분석: 악성코드가 사용하는 API 호출을 분석하여 악성 행위를 식별
- String 분석: 코드 내 문자열을 분석하여 악성 코드의 기능 및 특징을 파악

#### 정상 분석 (Heuristic Analysis)

- 파일시스템 분석: 파일시스템에 변화를 주는지 분석
- 프로세스 분석: 악성코드에 의해 생성되는 프로세스를 분석
- 레지스트리 분석: 악성코드가 레지스트리에 어떠한 변화를 주는지 분석
- 네트워크 분석: 네트워크 활동을 통해 악성코드의 행위를 분석
- 기타 분석: 기타 악성코드의 행위를 분석

#### 정보 분석 (Information Analysis)

- 조직 상호 분석: 악성코드 간의 관계를 분석
- 강도 정량 분석: 악성코드의 위험 수준을 정량적으로 분석
- 공격자 상황 분석: 공격자의 의도나 상황을 분석

#### 코드 분석 (Code Analysis)

- 패턴 디스어셈블러: 악성코드의 디스어셈블된 코드를 분석
- 대응 강화 연구소: 대응 방법을 연구

#### 패턴 제작 (Pattern Creation)

- 악성코드 패턴: 악성코드의 시그니처나 행위 기반 패턴을 제작
- 지표 시그니처 및 행위 제작: 공격자나 악성코드의 특정 지표나 시그니처를 기반으로 한 패턴을 제작
- 상세 분석보고서 작성: 상세한 분석 보고서를 작성

### 악성코드 분석 기법 종류 

#### 정적 속성 분석

- 악성코드를 실행하지 않고 코드 레벨에서 분석하는 방법

##### 단계
 
 - 컴파일 정보 확인: 악성코드가 어떤 언어로 작성되었는지, 어떤 컴파일러를 사용했는지 확인
 - 실행 압축 여부 확인: 악성코드가 분석을 회피하기 위해 압축되었는지 확인
 - 문자열 분석: 악성코드 내부의 문자열을 분석하여 악의적인 행동을 예측
 - 파일 무결성 검증: 파일의 해시값을 통해 파일이 변조되었는지 확인

#### 동적 자동화 분석

- 악성코드를 실제로 실행시켜 그 동작을 관찰하는 방식

##### 단계

- 프로세스 변화 관찰: 악성코드 실행 시 발생하는 프로세스 변화를 관찰
- 파일 시스템 변화 관찰: 파일이 생성, 수정, 삭제되는지를 모니터링
- 레지스트리 변화 관찰: 시스템 레지스트리의 변경사항을 체크
- 네트워크 트래픽 분석: 악성코드가 네트워크를 통해 데이터를 송수신하는지 확인
- API 호출 분석: 악성코드가 시스템 API를 어떻게 호출하는지 분석



#### 코드 역공학 분석(Reverse Engineering Analysis) 


<blockquote class="custom-lightgreen">
코드 역공학은 소프트웨어의 바이너리 파일을 분석하여, 소스 코드가 어떻게 작성되었는지, 어떤 기능을 수행하는지를 파악하는 과정으로 이를 통해 악성코드의 작동 원리, 행동 패턴, 통신 메커니즘 등을 이해할 수 있음
</blockquote>


- 정적 분석(Static Analysis): 실행 없이 코드를 분석하는 과정으로 바이너리를 디스어셈블하거나 디컴파일하여 얻은 코드에서 알고리즘을 파악하고, 악성 행위에 관련된 부분을 식별


- 디스어셈블링(Disassembling): 바이너리 파일에서 기계어 수준의 명령어(어셈블리 언어)로 변환하는 과정으로 IDA Pro, Ghidra와 같은 툴을 사용하여 변환

- 디컴파일링(Decompiling): 어셈블리 코드를 고수준 언어로 변환하는 과정으로 완벽한 소스코드로 복원하기는 어려우나, 프로그램의 로직을 이해 가능

- 코드 분석(Code Analysis): 특정 함수, 알고리즘, 통신 코드 등을 분석하여 악성코드의 특징과 동작을 파악

##### 대화형 동적 분석 (Interactive Dynamic Analysis)

<blockquote class="custom-lightgreen">
대화형 동적 분석은 악성코드를 실제로 실행시키며, 그 동작을 관찰하고 조작하는 과정으로 이를 통해 악성코드가 시스템에 실제로 미치는 영향을 파악할 수 있음
</blockquote>


- 실행 환경 설정(Environment Setup): 안전한 분석 환경을 구축. 일반적으로 가상머신이나 격리된 테스트 환경에서 이루어짐

- 실행 및 모니터링(Execution and Monitoring): 악성코드를 실행하고 시스템의 반응을 모니터링. 파일 시스템의 변화, 네트워크 통신, 레지스트리 변경 등을 관찰

- 디버깅(Debugging): 악성코드 실행 중 디버거를 이용하여 코드의 실행 흐름을 중단하고, 변수의 값, 메모리 상태 등을 검사. OllyDbg, x64dbg, GDB 등이 사용

- 조작(Manipulation): 디버거를 통해 코드의 특정 지점에서 프로그램의 행동을 변경 가능. 이를 통해 악성코드의 특정 기능을 활성화하거나 비활성화할 수 있음

### 악성코드 전파 과정

#### 전자메일

- 가장 일반적인 악성코드 전파 방식으로, 이메일 첨부파일이나 링크를 통해 전파
- 사회공학적 기법을 사용하여 사용자를 속여 파일을 열게 하거나 링크를 클릭하게 만듦
  
#### 홈페이지

- 악성코드를 웹사이트에 삽입하여 방문자의 컴퓨터를 감염키는 방식(워터링홀 공격)

#### 공급망 공격

- 소프트웨어 공급망을 해킹하여 정상적인 업데이트 파일에 악성코드를 삽입하는 방법

### 최근 악성코드 동향

#### 드롭퍼(Dropper)

<blockquote class="custom-lightblue">
실행 파일 내부에 악성코드를 포함하여 배포하는 방식으로, 안티바이러스의 탐지를 피하기 위해 악성코드를 압축하거나 암호화
</blockquote>


#### 파일리스(Fileless) 공격

<blockquote class="custom-lightblue">
파일 시스템에 파일을 남기지 않고 메모리 상에서만 실행되는 악성코드입니다. 보안 소프트웨어의 탐지를 우회하기 위해 사용
</blockquote>


#### 문서형 APT 공격

<blockquote class="custom-lightblue">
  악성코드를 문서 파일(.doc, .pdf 등) 내에 숨겨 사용자가 문서를 열었을 때 실행되도록 하는 방식으로 매크로나 스크립트를 이용해 악성코드를 다운로드하거나 직접 실행
</blockquote>
